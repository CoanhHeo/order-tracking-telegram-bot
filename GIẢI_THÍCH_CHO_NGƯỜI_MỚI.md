# üìö GI·∫¢I TH√çCH D·ª∞ √ÅN CHO NG∆Ø·ªúI M·ªöI

## üéØ D·ª± √°n n√†y l√†m g√¨?

ƒê√¢y l√† m·ªôt **bot Telegram** gi√∫p b·∫°n **t·ª± ƒë·ªông theo d√µi ƒë∆°n h√†ng** t·ª´ Lazada v√† Shopee.

### V√≠ d·ª• th·ª±c t·∫ø:
1. B·∫°n mua h√†ng tr√™n Lazada, m√£ ƒë∆°n h√†ng: `123456`
2. B·∫°n n√≥i v·ªõi bot: `/addorder` ‚Üí Ch·ªçn Lazada ‚Üí Nh·∫≠p `123456`
3. **Bot t·ª± ƒë·ªông ki·ªÉm tra** m·ªói 30 ph√∫t
4. Khi ƒë∆°n h√†ng **chuy·ªÉn t·ª´ "ƒëang x·ª≠ l√Ω" ‚Üí "ƒëang giao"**, bot g·ª≠i tin nh·∫Øn cho b·∫°n ngay l·∫≠p t·ª©c!

**L·ª£i √≠ch:**
- ‚úÖ Kh√¥ng c·∫ßn m·ªü app Lazada/Shopee nhi·ªÅu l·∫ßn
- ‚úÖ Kh√¥ng b·ªè l·ª° c·∫≠p nh·∫≠t quan tr·ªçng
- ‚úÖ Qu·∫£n l√Ω nhi·ªÅu ƒë∆°n h√†ng t·ª´ nhi·ªÅu s√†n ·ªü 1 ch·ªó

---

## üèóÔ∏è Ki·∫øn tr√∫c h·ªá th·ªëng (ƒê∆°n gi·∫£n h√≥a)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   B·∫†N        ‚îÇ  G·ª≠i l·ªánh /orders
‚îÇ  (Telegram)  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         TELEGRAM BOT                 ‚îÇ
‚îÇ  "B·ªô n√£o" x·ª≠ l√Ω l·ªánh c·ªßa b·∫°n        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         MONGODB                      ‚îÇ
‚îÇ  "B·ªô nh·ªõ" l∆∞u th√¥ng tin ƒë∆°n h√†ng    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         SCHEDULER                    ‚îÇ
‚îÇ  "ƒê·ªìng h·ªì b√°o th·ª©c" ki·ªÉm tra         ‚îÇ
‚îÇ  ƒë∆°n h√†ng m·ªói 30 ph√∫t               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ    LAZADA/SHOPEE API                 ‚îÇ
‚îÇ  "Ngu·ªìn d·ªØ li·ªáu" v·ªÅ ƒë∆°n h√†ng        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üìÇ C·∫•u tr√∫c th∆∞ m·ª•c (Gi·∫£i th√≠ch ƒë∆°n gi·∫£n)

```
src/
‚îú‚îÄ‚îÄ index.ts              ‚Üí "C·ª≠a ch√≠nh" - Kh·ªüi ƒë·ªông to√†n b·ªô ·ª©ng d·ª•ng
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ index.ts          ‚Üí "T·ªß ƒë·ªì" - L∆∞u c√°c c·∫•u h√¨nh (token, API key)
‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îî‚îÄ‚îÄ index.ts          ‚Üí "·ªî kh√≥a" - K·∫øt n·ªëi ƒë·∫øn MongoDB
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îú‚îÄ‚îÄ User.ts           ‚Üí "M·∫´u gi·∫•y t·ªù User" - C·∫•u tr√∫c d·ªØ li·ªáu ng∆∞·ªùi d√πng
‚îÇ   ‚îú‚îÄ‚îÄ Order.ts          ‚Üí "M·∫´u gi·∫•y t·ªù Order" - C·∫•u tr√∫c d·ªØ li·ªáu ƒë∆°n h√†ng
‚îÇ   ‚îî‚îÄ‚îÄ UserCredentials.ts ‚Üí "K√©t s·∫Øt" - L∆∞u token API c·ªßa user
‚îú‚îÄ‚îÄ bot/
‚îÇ   ‚îú‚îÄ‚îÄ index.ts          ‚Üí "T·ªïng ƒë√†i vi√™n" - ƒêi·ªÅu ph·ªëi bot
‚îÇ   ‚îú‚îÄ‚îÄ commands.ts       ‚Üí "S·ªï tay l·ªánh" - X·ª≠ l√Ω /start, /orders, v.v.
‚îÇ   ‚îî‚îÄ‚îÄ callbacks.ts      ‚Üí "B·ªô x·ª≠ l√Ω n√∫t b·∫•m" - X·ª≠ l√Ω khi user click n√∫t
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ LazadaService.ts  ‚Üí "C·∫ßu n·ªëi Lazada" - G·ªçi API Lazada
‚îÇ   ‚îî‚îÄ‚îÄ ShopeeService.ts  ‚Üí "C·∫ßu n·ªëi Shopee" - G·ªçi API Shopee
‚îî‚îÄ‚îÄ scheduler/
    ‚îî‚îÄ‚îÄ OrderScheduler.ts ‚Üí "ƒê·ªìng h·ªì b√°o th·ª©c" - Ki·ªÉm tra t·ª± ƒë·ªông
```

---

## üîÑ Lu·ªìng ho·∫°t ƒë·ªông ch√≠nh

### 1Ô∏è‚É£ User th√™m ƒë∆°n h√†ng

```
B·∫°n: /addorder
Bot: "Ch·ªçn s√†n: [Lazada] [Shopee]"
B·∫°n: *Click Lazada*
Bot: "Nh·∫≠p m√£ ƒë∆°n h√†ng:"
B·∫°n: "123456"
Bot: "‚úÖ ƒê√£ th√™m th√†nh c√¥ng!"

‚Üí L∆∞u v√†o MongoDB: { userId, orderId: "123456", platform: "lazada" }
```

### 2Ô∏è‚É£ Scheduler ki·ªÉm tra t·ª± ƒë·ªông

```
‚è∞ M·ªói 30 ph√∫t:
1. L·∫•y t·∫•t c·∫£ ƒë∆°n h√†ng ch∆∞a ho√†n th√†nh t·ª´ MongoDB
2. V·ªõi m·ªói ƒë∆°n h√†ng:
   - G·ªçi API Lazada/Shopee ƒë·ªÉ l·∫•y tr·∫°ng th√°i m·ªõi
   - So s√°nh v·ªõi tr·∫°ng th√°i c≈© trong DB
   - N·∫øu kh√°c nhau ‚Üí G·ª≠i th√¥ng b√°o cho user
```

### 3Ô∏è‚É£ G·ª≠i th√¥ng b√°o

```
Tr·∫°ng th√°i c≈©: "ƒêang x·ª≠ l√Ω"
Tr·∫°ng th√°i m·ªõi: "ƒêang giao"

Bot g·ª≠i: 
"üõí C·∫¨P NH·∫¨T ƒê∆†N H√ÄNG
 üìã M√£: 123456
 üè™ S√†n: LAZADA
 üìä C≈©: ƒêang x·ª≠ l√Ω
 üöö M·ªõi: ƒêang giao"
```

---

## üõ†Ô∏è C√°c c√¥ng ngh·ªá & T·∫°i sao ch·ªçn?

### 1. **Node.js** (N·ªÅn t·∫£ng ch·∫°y JavaScript)
- **So s√°nh**: Gi·ªëng nh∆∞ "ƒë·ªông c∆°" c·ªßa xe
- **T·∫°i sao?** Ph√π h·ª£p ƒë·ªÉ x·ª≠ l√Ω nhi·ªÅu k·∫øt n·ªëi c√πng l√∫c (bot, database, API)

### 2. **TypeScript** (JavaScript c√≥ ki·ªÉu d·ªØ li·ªáu)
- **So s√°nh**: JavaScript m·∫∑c √°o gi√°p
- **T·∫°i sao?** B·∫Øt l·ªói s·ªõm h∆°n, code d·ªÖ ƒë·ªçc h∆°n
- **V√≠ d·ª•**:
  ```typescript
  // JavaScript - D·ªÖ l·ªói
  function add(a, b) { return a + b; }
  add("2", 3);  // "23" (bug!)
  
  // TypeScript - B·∫Øt l·ªói ngay
  function add(a: number, b: number): number { return a + b; }
  add("2", 3);  // ‚ùå L·ªói compile!
  ```

### 3. **MongoDB** (Database l∆∞u d·ªØ li·ªáu)
- **So s√°nh**: Gi·ªëng nh∆∞ "t·ªß h·ªì s∆°"
- **T·∫°i sao d√πng MongoDB thay v√¨ MySQL?**
  - MongoDB: L∆∞u d·∫°ng JSON ‚Üí D·ªÖ l√†m vi·ªác v·ªõi Node.js
  - MySQL: L∆∞u d·∫°ng b·∫£ng ‚Üí C·ª©ng nh·∫Øc h∆°n
  
  ```javascript
  // MongoDB document (linh ho·∫°t)
  {
    userId: 123,
    orderId: "456",
    items: [
      { name: "√Åo", price: 100 },
      { name: "Qu·∫ßn", price: 200 }
    ]
  }
  
  // MySQL table (c·∫ßn nhi·ªÅu b·∫£ng)
  Table: orders (userId, orderId)
  Table: order_items (orderId, name, price)
  ```

### 4. **Mongoose** (ODM cho MongoDB)
- **So s√°nh**: "Th∆∞ k√Ω" gi√∫p l√†m vi·ªác v·ªõi MongoDB d·ªÖ h∆°n
- **T·∫°i sao?**
  - Validate d·ªØ li·ªáu t·ª± ƒë·ªông
  - ƒê·ªãnh nghƒ©a c·∫•u tr√∫c r√µ r√†ng
  - T√≠ch h·ª£p TypeScript t·ªët

### 5. **node-telegram-bot-api** (Th∆∞ vi·ªán bot Telegram)
- **So s√°nh**: "ƒêi·ªán tho·∫°i" ƒë·ªÉ n√≥i chuy·ªán v·ªõi Telegram
- **T·∫°i sao?** Kh√¥ng ph·∫£i t·ª± vi·∫øt logic k·∫øt n·ªëi Telegram

### 6. **node-cron** (Scheduler)
- **So s√°nh**: "ƒê·ªìng h·ªì b√°o th·ª©c"
- **T·∫°i sao?** T·ª± ƒë·ªông ch·∫°y code theo l·ªãch ƒë·ªãnh s·∫µn
  ```javascript
  cron.schedule('*/30 * * * *', () => {
    // Ch·∫°y m·ªói 30 ph√∫t
    checkOrders();
  });
  ```

### 7. **Axios** (HTTP client)
- **So s√°nh**: "B∆∞u t√°" g·ª≠i/nh·∫≠n request API
- **T·∫°i sao d√πng Axios thay v√¨ fetch?**
  - T·ª± ƒë·ªông parse JSON
  - X·ª≠ l√Ω l·ªói t·ªët h∆°n
  - Timeout d·ªÖ d√†ng

### 8. **crypto-js** (M√£ h√≥a)
- **So s√°nh**: "M√°y t·∫°o ch·ªØ k√Ω s·ªë"
- **T·∫°i sao?** API Lazada/Shopee y√™u c·∫ßu "ch·ªØ k√Ω" ƒë·ªÉ b·∫£o m·∫≠t
  ```typescript
  // T·∫°o ch·ªØ k√Ω (signature)
  const signature = HMAC_SHA256(secret, data);
  // API verify ch·ªØ k√Ω ‚Üí ƒê·∫£m b·∫£o request h·ª£p l·ªá
  ```

### 9. **dotenv** (Qu·∫£n l√Ω bi·∫øn m√¥i tr∆∞·ªùng)
- **So s√°nh**: "K√©t s·∫Øt" ch·ª©a th√¥ng tin b√≠ m·∫≠t
- **T·∫°i sao?** Kh√¥ng hardcode token/key trong code
  ```javascript
  // ‚ùå Nguy hi·ªÉm - Ai c≈©ng th·∫•y n·∫øu code b·ªã leak
  const TOKEN = "123456:ABCdef...";
  
  // ‚úÖ An to√†n - Token ·ªü file .env (kh√¥ng commit l√™n Git)
  const TOKEN = process.env.TELEGRAM_BOT_TOKEN;
  ```

---

## üîê B·∫£o m·∫≠t - Quan tr·ªçng!

### 1. File `.env` ch·ª©a secrets
```env
# File .env - KH√îNG BAO GI·ªú commit l√™n Git!
TELEGRAM_BOT_TOKEN=123456:ABCdefGHI...
MONGODB_URI=mongodb://localhost:27017/...
LAZADA_APP_KEY=1234567890
LAZADA_APP_SECRET=abcdefghijklmnop
```

### 2. File `.gitignore` ngƒÉn kh√¥ng cho commit
```
.env          ‚Üê PH·∫¢I c√≥ d√≤ng n√†y!
node_modules/
dist/
```

### 3. File `.env.example` l√†m template
```env
# .env.example - Commit ƒë∆∞·ª£c, kh√¥ng ch·ª©a gi√° tr·ªã th·∫≠t
TELEGRAM_BOT_TOKEN=your_token_here
MONGODB_URI=your_mongodb_uri_here
```

---

## üöÄ C√°ch ch·∫°y d·ª± √°n (Step by step)

### B∆∞·ªõc 1: C√†i ƒë·∫∑t
```bash
# Clone d·ª± √°n
git clone <repo-url>
cd order-tracking-telegram-bot

# C√†i dependencies
npm install
```

### B∆∞·ªõc 2: C·∫•u h√¨nh
```bash
# Copy file m·∫´u
cp .env.example .env

# S·ª≠a file .env, ƒëi·ªÅn c√°c gi√° tr·ªã th·∫≠t
nano .env
```

### B∆∞·ªõc 3: Ch·∫°y
```bash
# Development (t·ª± ƒë·ªông reload khi s·ª≠a code)
npm run dev

# Production
npm run build
npm start
```

---

## üêõ Debug khi c√≥ l·ªói

### L·ªói: "Cannot connect to MongoDB"
```bash
# Check MongoDB c√≥ ch·∫°y kh√¥ng?
sudo systemctl status mongod

# N·∫øu kh√¥ng ch·∫°y:
sudo systemctl start mongod
```

### L·ªói: "Bot kh√¥ng ph·∫£n h·ªìi"
```bash
# Check token c√≥ ƒë√∫ng kh√¥ng?
echo $TELEGRAM_BOT_TOKEN

# Test bot token:
curl https://api.telegram.org/bot<TOKEN>/getMe
```

### L·ªói: "API signature invalid"
```bash
# Check trong code:
console.log('Signature string:', signString);
console.log('Generated signature:', signature);

# Common issue: Params kh√¥ng sort ƒë√∫ng th·ª© t·ª±
```

---

## üìñ H·ªçc th√™m

### T√†i li·ªáu ch√≠nh th·ª©c:
- [Node.js Docs](https://nodejs.org/docs/)
- [TypeScript Handbook](https://www.typescriptlang.org/docs/)
- [MongoDB Manual](https://docs.mongodb.com/)
- [Telegram Bot API](https://core.telegram.org/bots/api)

### Kh√≥a h·ªçc g·ª£i √Ω:
- Node.js: "Node.js - The Complete Guide" (Udemy)
- TypeScript: "Understanding TypeScript" (Udemy)
- MongoDB: "MongoDB - The Complete Developer's Guide" (Udemy)

---

## ‚ùì C√¢u h·ªèi th∆∞·ªùng g·∫∑p (FAQ)

### Q1: T·∫°i sao d√πng Telegram thay v√¨ web app?
**A:** 
- Kh√¥ng c·∫ßn build frontend ph·ª©c t·∫°p
- Telegram c√≥ s·∫µn notification
- User kh√¥ng c·∫ßn c√†i th√™m app

### Q2: C√≥ th·ªÉ th√™m s√†n kh√°c (Tiki, Sendo) kh√¥ng?
**A:** C√≥! T·∫°o file `TikiService.ts` t∆∞∆°ng t·ª± `LazadaService.ts`

### Q3: Scheduler c√≥ t·ªën t√†i nguy√™n kh√¥ng?
**A:** Kh√¥ng nhi·ªÅu. Ch·ªâ ch·∫°y m·ªói 30 ph√∫t, query c√≥ index n√™n nhanh.

### Q4: L√†m sao ƒë·ªÉ deploy l√™n server?
**A:** 
1. Thu√™ VPS (DigitalOcean, AWS EC2)
2. C√†i Node.js, MongoDB
3. Clone code, `npm install`, ch·∫°y v·ªõi PM2

### Q5: Bot c√≥ th·ªÉ handle ƒë∆∞·ª£c bao nhi√™u user?
**A:** 
- Single server: ~1000-5000 users
- V·ªõi load balancer + MongoDB cluster: H√†ng tri·ªáu users

---

**üéâ Ch√∫c b·∫°n h·ªçc t·ªët v√† code vui v·∫ª!**
